window.__require=function e(t,n,i){function s(r,a){if(!n[r]){if(!t[r]){var c=r.split("/");if(c=c[c.length-1],!t[c]){var h="function"==typeof __require&&__require;if(!a&&h)return h(c,!0);if(o)return o(c,!0);throw new Error("Cannot find module '"+r+"'")}}var u=n[r]={exports:{}};t[r][0].call(u.exports,function(e){return s(t[r][1][e]||e)},u,u.exports,e,t,n,i)}return n[r].exports}for(var o="function"==typeof __require&&__require,r=0;r<i.length;r++)s(i[r]);return s}({Base:[function(e,t,n){"use strict";cc._RF.push(t,"ebde7hi5NBIlowoLUvneYGG","Base");var i=e("MainEmitter"),s=e("EventCode").GAME_EVENTS,o=e("EventEmitter"),r=e("Key");cc.Class({extends:cc.Component,properties:{healthBar:cc.ProgressBar,maxHealth:50,curHealth:0,explosionSound:{default:null,type:cc.AudioClip}},onLoad:function(){this.curHealth=this.maxHealth,i.instance.registerEvent(s.HIT_BASE,this.onHitBase.bind(this))},onHitBase:function(e){this.curHealth-=e,this.healthBar.progress=this.curHealth/this.maxHealth,this.curHealth<=0&&(o.instance.emit(r.PLAY_SFX,this.explosionSound),this.node.getChildByName("Base Explosion").active=!0,this.healthBar.active=!1,i.instance.emit(s.END_GAME),this.node.getChildByName("Sprite").color=cc.Color.GRAY)}}),cc._RF.pop()},{EventCode:"EventCode",EventEmitter:"EventEmitter",Key:"Key",MainEmitter:"MainEmitter"}],Bullet:[function(e,t,n){"use strict";cc._RF.push(t,"2d759sq75lOx4l/vUtraiZD","Bullet"),cc.Class({extends:cc.Component,properties:{speed:20,damage:0},update:function(e){this.node.x+=this.velocity.x,this.node.y+=this.velocity.y},configBullet:function(e){this.damage=e.damage,this.getComponent(cc.Sprite).spriteFrame=e.spriteFrame,this.node.width=e.size.width,this.node.height=e.size.height},setVelocity:function(){var e=(this.node.angle-180)*(Math.PI/180)-Math.PI/2;this.velocity=cc.v2(Math.cos(e)*this.speed,Math.sin(e)*this.speed)},onCollisionEnter:function(e,t){"enemy"===e.node.group&&(this.node.destroy(),e.node.getComponent("Enemy").takeDamage(this.damage))}}),cc._RF.pop()},{}],1:[function(e,t,n){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function s(e){return"function"==typeof e}function o(e){return"number"==typeof e}function r(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(e){if(!o(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},i.prototype.emit=function(e){var t,n,i,o,c,h;if(this._events||(this._events={}),"error"===e&&(!this._events.error||r(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var u=new Error('Uncaught, unspecified "error" event. ('+t+")");throw u.context=t,u}if(a(n=this._events[e]))return!1;if(s(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),n.apply(this,o)}else if(r(n))for(o=Array.prototype.slice.call(arguments,1),i=(h=n.slice()).length,c=0;c<i;c++)h[c].apply(this,o);return!0},i.prototype.addListener=function(e,t){var n;if(!s(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,s(t.listener)?t.listener:t),this._events[e]?r(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,r(this._events[e])&&!this._events[e].warned&&(n=a(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(e,t){if(!s(t))throw TypeError("listener must be a function");var n=!1;function i(){this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}return i.listener=t,this.on(e,i),this},i.prototype.removeListener=function(e,t){var n,i,o,a;if(!s(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(o=(n=this._events[e]).length,i=-1,n===t||s(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(r(n)){for(a=o;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){i=a;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},i.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(s(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){return this._events&&this._events[e]?s(this._events[e])?[this._events[e]]:this._events[e].slice():[]},i.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(s(t))return 1;if(t)return t.length}return 0},i.listenerCount=function(e,t){return e.listenerCount(t)}},{}],EnemyWaves:[function(e,t,n){"use strict";cc._RF.push(t,"98a775zeI9FH4lkMC/tsSZk","EnemyWaves");var i=e("MainEmitter"),s=e("EventCode").UI_EVENTS,o=e("WaveData");cc.Class({extends:cc.Component,properties:{wave:{default:null,type:o}},init:function(e){this.waveIndex=0,this.enemyCount=0,this.isBoss=!1,this.bossCreated=0,this.level=e,this.items=[],this.createWave()},createWave:function(){var e=this,t=this.wave;i.instance.emit(s.CREATE_WAVE),++this.waveIndex;var n=0;1===this.waveIndex?this.enemiesCount=5:2===this.waveIndex?this.enemiesCount=10:this.enemiesCount++,this.schedule(function(){i.instance.emit(s.UPDATE_WAVE_COUNT,e.waveIndex),e.createEnemy(t.enemies,e.waveIndex,n),n++},t.repeatInterval,this.enemiesCount-1,t.timeout)},createEnemy:function(e,t,n){var i=this,s=this.enemiesCount-1;5===t&&n===s||10===t&&n===s?(this.isBoss=!0,this.bossCreated++):this.isBoss=!1;var o=e[this.isBoss?2:Math.floor(Math.random()*(e.length-1))],r=cc.instantiate(o);this.node.addChild(r);var a=r.getComponent("Enemy");this.isBoss?(5===t&&(a.health=1500,a.coins=500),10===t&&(a.health=3e3,a.coins=1e3)):(a.health=a.health*t,a.coins=a.coins*t),a.init(this.level),this.items.push(a),r.once("killed",function(){i.onEnemyRemoved("enemy-killed",a)},this),r.once("finished",function(){i.onEnemyRemoved("enemy-finished",a)},this)},onEnemyRemoved:function(e,t){this.node.emit(e,t),this.items=this.items.filter(function(e){return e!==t}),this.items.length||this.createWave()}}),cc._RF.pop()},{EventCode:"EventCode",MainEmitter:"MainEmitter",WaveData:"WaveData"}],Enemy:[function(e,t,n){"use strict";cc._RF.push(t,"67ed0+CLJJM8oTR1Qg4EHKL","Enemy");var i=e("MainEmitter"),s=e("EventCode").GAME_EVENTS;cc.Class({extends:cc.Component,properties:{velocity:{default:150,serializable:!0},health:50,damage:{default:10,serializable:!0},coins:{default:10,serializable:!0},_rotationSpeed:300},init:function(e){this.levelMap=e.map},start:function(){this.targets=this.levelMap.tiledMap.getObjectGroup("path").getObjects(),this.targetIndex=1,this.node.setPosition(this.getCurrentTargetPosition()),this.targetIndex++,this.move()},move:function(){var e=this,t=this.getCurrentTargetPosition();t?(this.rotateTo(t),this.moveTo(t).then(function(){e.targetIndex++,e.move()})):(this.node.emit("finished"),this.node.destroy())},getAngle:function(e){return-180*Math.atan2(e.y-this.node.y,e.x-this.node.x)/Math.PI},rotateTo:function(e){var t=this.getAngle(e),n=Math.abs(t-this.node.angle);if(n){var i=n/this._rotationSpeed;this.node.runAction(cc.rotateTo(i,t))}},moveTo:function(e){var t=this,n=Math.abs(e.x-this.node.x),i=Math.abs(e.y-this.node.y),s=Math.max(n,i)/this.velocity;return new Promise(function(n){var i=cc.moveTo(s,e),o=cc.sequence(i,cc.callFunc(n));t.node.runAction(o)})},getCurrentTarget:function(){var e=this;return this.targets.find(function(t){return parseInt(t.name)===e.targetIndex})},getCurrentTargetPosition:function(){var e=this.getCurrentTarget();if(!e)return!1;var t=this.levelMap.getTileCoordinatesByPosition(cc.v2(e.x,e.y)),n=this.levelMap.roadsLayer.getPositionAt(t.x,t.y);return cc.v2(n.x+this.levelMap.tileWidth/2,n.y+this.levelMap.tileWidth/2)},takeDamage:function(e){this.health-=e,this.health<=0&&(this.node.stopAllActions(),this.node.emit("killed"),i.instance.emit(s.ENEMY_KILLED,this.coins),this.node.destroy())},onCollisionEnter:function(e,t){"base"===e.node.group&&i.instance.emit(s.HIT_BASE,this.damage)}}),cc._RF.pop()},{EventCode:"EventCode",MainEmitter:"MainEmitter"}],EventCode:[function(e,t,n){"use strict";cc._RF.push(t,"e9a79QGzPxLvoy/FeaKrFnw","EventCode");t.exports={GAME_EVENTS:{ENEMY_KILLED:"enemy-killed",HIT_BASE:"hit-base",END_GAME:"end-game",INSTANTIATE_TOWER:"instantiate-tower",REQUEST_BUY_TOWER:"request-buy-tower",CREATE_TOWER:"create-tower",SELL_TOWER:"sell-tower",REQUEST_UPGRADE_TOWER:"request-upgrade-tower",UPGRADE_TOWER:"upgrade-tower"},UI_EVENTS:{CREATE_WAVE:"create-wave",UPDATE_WAVE_COUNT:"update-wave-count",UPDATE_COINS_AMOUNT:"update-coins-amount"},SOUND_EVENTS:{TOWER_SHOOT:"tower-shoot"}},cc._RF.pop()},{}],EventEmitter:[function(e,t,n){"use strict";cc._RF.push(t,"10a70sUlt9ExKMIdskC12bD","EventEmitter");var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=e("events"),r=function(){function e(){s(this,e),this._emitter=new o,this._emitter.setMaxListeners(100)}return i(e,[{key:"emit",value:function(){var e;(e=this._emitter).emit.apply(e,arguments)}},{key:"registerEvent",value:function(e,t){this._emitter.on(e,t)}},{key:"registerOnce",value:function(e,t){this._emitter.once(e,t)}},{key:"removeEvent",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"destroy",value:function(){this._emitter.removeAllListeners(),this._emitter=null,e.instance=null}}]),e}();r.instance=null,t.exports=r,cc._RF.pop()},{events:1}],2:[function(e,t,n){(function(e,i){"object"==typeof n&&"object"==typeof t?t.exports=i():"function"==typeof define&&define.amd?define("StateMachine",[],i):"object"==typeof n?n.StateMachine=i():e.StateMachine=i()})(this,function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){"use strict";e.exports=function(e,t){var n,i,s;for(n=1;n<arguments.length;n++)for(s in i=arguments[n])i.hasOwnProperty(s)&&(e[s]=i[s]);return e}},function(e,t,n){"use strict";var i=n(0);e.exports={build:function(e,t){var n,s,o,r=t.plugins;for(n=0,s=r.length;n<s;n++)(o=r[n]).methods&&i(e,o.methods),o.properties&&Object.defineProperties(e,o.properties)},hook:function(e,t,n){var i,s,o,r,a=e.config.plugins,c=[e.context];for(n&&(c=c.concat(n)),i=0,s=a.length;i<s;i++)r=a[i],(o=a[i][t])&&o.apply(r,c)}}},function(e,t,n){"use strict";function i(e){if(0===e.length)return e;var t,n,i=e.split(/[_-]/);if(1===i.length&&i[0][0].toLowerCase()===i[0][0])return e;for(n=i[0].toLowerCase(),t=1;t<i.length;t++)n=n+i[t].charAt(0).toUpperCase()+i[t].substring(1).toLowerCase();return n}i.prepended=function(e,t){return e+(t=i(t))[0].toUpperCase()+t.substring(1)},e.exports=i},function(e,t,n){"use strict";var i=n(0),s=n(2);function o(e,t){e=e||{},this.options=e,this.defaults=t.defaults,this.states=[],this.transitions=[],this.map={},this.lifecycle=this.configureLifecycle(),this.init=this.configureInitTransition(e.init),this.data=this.configureData(e.data),this.methods=this.configureMethods(e.methods),this.map[this.defaults.wildcard]={},this.configureTransitions(e.transitions||[]),this.plugins=this.configurePlugins(e.plugins,t.plugin)}i(o.prototype,{addState:function(e){this.map[e]||(this.states.push(e),this.addStateLifecycleNames(e),this.map[e]={})},addStateLifecycleNames:function(e){this.lifecycle.onEnter[e]=s.prepended("onEnter",e),this.lifecycle.onLeave[e]=s.prepended("onLeave",e),this.lifecycle.on[e]=s.prepended("on",e)},addTransition:function(e){this.transitions.indexOf(e)<0&&(this.transitions.push(e),this.addTransitionLifecycleNames(e))},addTransitionLifecycleNames:function(e){this.lifecycle.onBefore[e]=s.prepended("onBefore",e),this.lifecycle.onAfter[e]=s.prepended("onAfter",e),this.lifecycle.on[e]=s.prepended("on",e)},mapTransition:function(e){var t=e.name,n=e.from,i=e.to;return this.addState(n),"function"!=typeof i&&this.addState(i),this.addTransition(t),this.map[n][t]=e,e},configureLifecycle:function(){return{onBefore:{transition:"onBeforeTransition"},onAfter:{transition:"onAfterTransition"},onEnter:{state:"onEnterState"},onLeave:{state:"onLeaveState"},on:{transition:"onTransition"}}},configureInitTransition:function(e){return"string"==typeof e?this.mapTransition(i({},this.defaults.init,{to:e,active:!0})):"object"==typeof e?this.mapTransition(i({},this.defaults.init,e,{active:!0})):(this.addState(this.defaults.init.from),this.defaults.init)},configureData:function(e){return"function"==typeof e?e:"object"==typeof e?function(){return e}:function(){return{}}},configureMethods:function(e){return e||{}},configurePlugins:function(e,t){var n,i,s;for(n=0,i=(e=e||[]).length;n<i;n++)"function"==typeof(s=e[n])&&(e[n]=s=s()),s.configure&&s.configure(this);return e},configureTransitions:function(e){var t,n,i,s,o,r=this.defaults.wildcard;for(n=0;n<e.length;n++)for(i=e[n],s=Array.isArray(i.from)?i.from:[i.from||r],o=i.to||r,t=0;t<s.length;t++)this.mapTransition({name:i.name,from:s[t],to:o})},transitionFor:function(e,t){var n=this.defaults.wildcard;return this.map[e][t]||this.map[n][t]},transitionsFor:function(e){var t=this.defaults.wildcard;return Object.keys(this.map[e]).concat(Object.keys(this.map[t]))},allStates:function(){return this.states},allTransitions:function(){return this.transitions}}),e.exports=o},function(e,t,n){var i=n(0),s=n(6),o=n(1),r=[null,[]];function a(e,t){this.context=e,this.config=t,this.state=t.init.from,this.observers=[e]}i(a.prototype,{init:function(e){if(i(this.context,this.config.data.apply(this.context,e)),o.hook(this,"init"),this.config.init.active)return this.fire(this.config.init.name,[])},is:function(e){return Array.isArray(e)?e.indexOf(this.state)>=0:this.state===e},isPending:function(){return this.pending},can:function(e){return!this.isPending()&&!!this.seek(e)},cannot:function(e){return!this.can(e)},allStates:function(){return this.config.allStates()},allTransitions:function(){return this.config.allTransitions()},transitions:function(){return this.config.transitionsFor(this.state)},seek:function(e,t){var n=this.config.defaults.wildcard,i=this.config.transitionFor(this.state,e),s=i&&i.to;return"function"==typeof s?s.apply(this.context,t):s===n?this.state:s},fire:function(e,t){return this.transit(e,this.state,this.seek(e,t),t)},transit:function(e,t,n,i){var s=this.config.lifecycle,o=this.config.options.observeUnchangedState||t!==n;return n?this.isPending()?this.context.onPendingTransition(e,t,n):(this.config.addState(n),this.beginTransit(),i.unshift({transition:e,from:t,to:n,fsm:this.context}),this.observeEvents([this.observersForEvent(s.onBefore.transition),this.observersForEvent(s.onBefore[e]),o?this.observersForEvent(s.onLeave.state):r,o?this.observersForEvent(s.onLeave[t]):r,this.observersForEvent(s.on.transition),o?["doTransit",[this]]:r,o?this.observersForEvent(s.onEnter.state):r,o?this.observersForEvent(s.onEnter[n]):r,o?this.observersForEvent(s.on[n]):r,this.observersForEvent(s.onAfter.transition),this.observersForEvent(s.onAfter[e]),this.observersForEvent(s.on[e])],i)):this.context.onInvalidTransition(e,t,n)},beginTransit:function(){this.pending=!0},endTransit:function(e){return this.pending=!1,e},failTransit:function(e){throw this.pending=!1,e},doTransit:function(e){this.state=e.to},observe:function(e){if(2===e.length){var t={};t[e[0]]=e[1],this.observers.push(t)}else this.observers.push(e[0])},observersForEvent:function(e){for(var t,n=0,i=this.observers.length,s=[];n<i;n++)(t=this.observers[n])[e]&&s.push(t);return[e,s,!0]},observeEvents:function(e,t,n,i){if(0===e.length)return this.endTransit(void 0===i||i);var s=e[0][0],r=e[0][1],a=e[0][2];if(t[0].event=s,s&&a&&s!==n&&o.hook(this,"lifecycle",t),0===r.length)return e.shift(),this.observeEvents(e,t,s,i);var c=r.shift(),h=c[s].apply(c,t);return h&&"function"==typeof h.then?h.then(this.observeEvents.bind(this,e,t,s)).catch(this.failTransit.bind(this)):!1===h?this.endTransit(!1):this.observeEvents(e,t,s,h)},onInvalidTransition:function(e,t,n){throw new s("transition is invalid in current state",e,t,n,this.state)},onPendingTransition:function(e,t,n){throw new s("transition is invalid while previous transition is still in progress",e,t,n,this.state)}}),e.exports=a},function(e,t,n){"use strict";var i=n(0),s=n(2),o=n(1),r=n(3),a=n(4),c={is:function(e){return this._fsm.is(e)},can:function(e){return this._fsm.can(e)},cannot:function(e){return this._fsm.cannot(e)},observe:function(){return this._fsm.observe(arguments)},transitions:function(){return this._fsm.transitions()},allTransitions:function(){return this._fsm.allTransitions()},allStates:function(){return this._fsm.allStates()},onInvalidTransition:function(e,t,n){return this._fsm.onInvalidTransition(e,t,n)},onPendingTransition:function(e,t,n){return this._fsm.onPendingTransition(e,t,n)}},h={state:{configurable:!1,enumerable:!0,get:function(){return this._fsm.state},set:function(e){throw Error("use transitions to change state")}}};function u(e){return l(this||{},e)}function l(e,t){return p(e,new r(t,u)),e._fsm(),e}function p(e,t){if("object"!=typeof e||Array.isArray(e))throw Error("StateMachine can only be applied to objects");o.build(e,t),Object.defineProperties(e,h),i(e,c),i(e,t.methods),t.allTransitions().forEach(function(t){e[s(t)]=function(){return this._fsm.fire(t,[].slice.call(arguments))}}),e._fsm=function(){this._fsm=new a(this,t),this._fsm.init(arguments)}}u.version="3.0.1",u.factory=function(){var e,t;"function"==typeof arguments[0]?(e=arguments[0],t=arguments[1]||{}):(e=function(){this._fsm.apply(this,arguments)},t=arguments[0]||{});var n=new r(t,u);return p(e.prototype,n),e.prototype._fsm.config=n,e},u.apply=l,u.defaults={wildcard:"*",init:{name:"init",from:"none"}},e.exports=u},function(e,t,n){"use strict";e.exports=function(e,t,n,i,s){this.message=e,this.transition=t,this.from=n,this.to=i,this.current=s}}])})},{}],GameManager:[function(e,t,n){"use strict";cc._RF.push(t,"a9b0a+VCK1BmopdGjoOVBXC","GameManager");var i=e("javascript-state-machine"),s=e("EventEmitter"),o=e("Key"),r="init",a="start",c="wave_complete",h="game_over";cc.Class({extends:cc.Component,properties:{HP:e("Base"),mSounds:{type:cc.AudioClip,default:[]}},onLoad:function(){var e=this;s.instance.registerEvent(o.SEND_DATA,function(t){cc.log(t),s.instance.emit(o.PLAY_MUSIC,e.mSounds[0])}.bind(this)),this._onStartGame=this.onStartGame.bind(this),this._onCompleteGame=this.onCompleteGame.bind(this),this._onGameOver=this.onGameOver.bind(this),this.fsm=new i({init:r,transitions:[{name:"goStart",from:r,to:a},{name:"goComplete",from:a,to:c},{name:"goOver",from:a,to:h}],methods:{onGoStart:this._onStartGame,onGoComplete:this._onCompleteGame,onGoOver:this._onGameOver}})},start:function(){var e=this;this.schedule(function(){e.HP.curHealth>0?cc.log("playing"):(cc.log("end Game"),e.unscheduleAllCallbacks())},1)},onStartGame:function(){cc.log("start game")},onCompleteGame:function(){cc.log("complete wave")},onGameOver:function(){cc.log("game over")}}),cc._RF.pop()},{Base:"Base",EventEmitter:"EventEmitter",Key:"Key","javascript-state-machine":2}],Key:[function(e,t,n){"use strict";cc._RF.push(t,"808f59yllREH60d0xBqyZqK","Key"),t.exports={POPUP_SHOW:"popupShow",POPUP_HIDE:"popupHide",PLAY_MUSIC:"playMusic",PLAY_SFX:"playSfx",CHANGE_SFX_VOLUME:"changeSfxVolume",CHANGE_MUSIC_VOLUME:"changeMusicVolume"},cc._RF.pop()},{}],LevelMap:[function(e,t,n){"use strict";cc._RF.push(t,"f398fUyZupLRIR9cy11+aqb","LevelMap"),cc.Class({extends:cc.Component,properties:{},init:function(){this.tiledMap=this.getComponent(cc.TiledMap),this.roadsLayer=this.tiledMap.getLayer("roads"),this.towersLayer=this.tiledMap.getLayer("towers"),this.tiledSize=this.tiledMap.getTileSize(),this.tileWidth=this.tiledSize.width,this.tileHeight=this.tiledSize.height,this.mapSize=this.tiledMap.getMapSize(),this.mapWidth=this.mapSize.width,this.mapHeight=this.mapSize.height},getTileCoordinatesByPosition:function(e){return{x:Math.floor(e.x/this.tileWidth),y:this.mapHeight-Math.floor(e.y/this.tileHeight)-1}}}),cc._RF.pop()},{}],Level:[function(e,t,n){"use strict";cc._RF.push(t,"04980rEz+hDLZ3jKOiUixFM","Level");var i=e("MainEmitter"),s=e("EventCode"),o=s.GAME_EVENTS,r=s.UI_EVENTS,a=e("LevelMap"),c=e("PanelCreate"),h=e("Towers"),u=e("PanelUpgrade"),l=e("EnemyWaves");cc.Class({extends:cc.Component,properties:{map:{default:null,type:a},panelCreate:{default:null,type:c},panelUpgrade:{default:null,type:u},towers:{default:null,type:h},enemyWaves:{default:null,type:l}},onLoad:function(){this.coins=60,this.init(),this.setEvents()},start:function(){i.instance.emit(r.UPDATE_COINS_AMOUNT,this.coins)},init:function(){cc.director.getCollisionManager().enabled=!0,this.map.init(),this.panelCreate.init(this.map),this.panelUpgrade.init(this.map),this.towers.init(this.map),this.enemyWaves.init(this)},setEvents:function(){this.map.node.on("touchend",this.onMapTouch,this),i.instance.registerEvent(o.REQUEST_BUY_TOWER,this.onRequestBuyTower.bind(this)),i.instance.registerEvent(o.ENEMY_KILLED,this.updateCoinsAmount.bind(this)),i.instance.registerEvent(o.SELL_TOWER,this.updateCoinsAmount.bind(this)),i.instance.registerEvent(o.REQUEST_UPGRADE_TOWER,this.onRequestUpgradeTower.bind(this))},onMapTouch:function(e){this.panelCreate.hide(),this.panelUpgrade.hide();var t=e.getLocation(),n={x:2*t.x,y:2*t.y},i=this.map.getTileCoordinatesByPosition(n);if(this.map.towersLayer.getTileGIDAt(i)){var s=this.towers.getByCoordinates(i);s?this.panelUpgrade.show(i,s):this.panelCreate.show(i)}},onRequestBuyTower:function(e){this.coins>=e?(i.instance.emit(o.CREATE_TOWER),this.updateCoinsAmount(-e)):console.log("Not enough coins to buy tower!"),this.panelCreate.hide()},onRequestUpgradeTower:function(e){this.coins>=e.upgradePrice?(e.upgradeTower(),this.updateCoinsAmount(-e.upgradePrice)):console.log("Not enough coins to upgrade tower!"),this.panelUpgrade.hide()},updateCoinsAmount:function(e){this.coins+=e,i.instance.emit(r.UPDATE_COINS_AMOUNT,this.coins)}}),cc._RF.pop()},{EnemyWaves:"EnemyWaves",EventCode:"EventCode",LevelMap:"LevelMap",MainEmitter:"MainEmitter",PanelCreate:"PanelCreate",PanelUpgrade:"PanelUpgrade",Towers:"Towers"}],MainEmitter:[function(e,t,n){"use strict";cc._RF.push(t,"9cba0opxORCvpkLRvxPMkQU","MainEmitter");var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=e("events"),r=function(){function e(){s(this,e),this._emiter=new o,this._emiter.setMaxListeners(100)}return i(e,[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}},{key:"emit",value:function(){var e;(e=this._emiter).emit.apply(e,arguments)}},{key:"registerEvent",value:function(e,t){this._emiter.on(e,t)}},{key:"registerOnce",value:function(e,t){this._emiter.once(e,t)}},{key:"removeEvent",value:function(e,t){this._emiter.removeListener(e,t)}},{key:"destroy",value:function(){this._emiter.removeAllListeners(),this._emiter=null,e.instance=null}}]),e}();r.instance=new r,t.exports=r,cc._RF.pop()},{events:1}],MenuManager:[function(e,t,n){"use strict";cc._RF.push(t,"052144YkiVE3qs/fTutm9+p","MenuManager");var i=e("EventEmitter"),s=e("Key"),o=e("SettingController");cc.Class({extends:cc.Component,properties:{mButton:[cc.Button],mainMenu:cc.Node,settingPopup:cc.Node,mMenuMusic:{type:cc.AudioClip,default:null}},start:function(){i.instance.emit(s.PLAY_MUSIC,this.mMenuMusic)},onStartGame:function(){cc.director.loadScene("Game",function(){cc.log(o),i.instance.emit(s.SEND_DATA,o)})},onSetting:function(){i.instance.emit(s.POPUP_SHOW,this.settingPopup),this.mButton.forEach(function(e){e.interactable=!1})},onBackMenu:function(){i.instance.emit(s.POPUP_HIDE,this.settingPopup),this.mButton.forEach(function(e){e.interactable=!0})}}),cc._RF.pop()},{EventEmitter:"EventEmitter",Key:"Key",SettingController:"SettingController"}],PanelCreate:[function(e,t,n){"use strict";cc._RF.push(t,"57748c2zQpCFpRbi469wSkI","PanelCreate");var i=e("MainEmitter"),s=e("EventCode").GAME_EVENTS;cc.Class({extends:cc.Component,properties:{panel1:cc.Node,panel2:cc.Node},init:function(e){this.map=e,this.coordinates={x:0,y:0},this.panel1.on("touchend",this.onPanelClick,this),this.panel2.on("touchend",this.onPanelClick,this)},show:function(e){this.coordinates=e;var t=this.map.towersLayer.getPositionAt(this.coordinates);this.node.setPosition(cc.v2(t.x+this.map.tileWidth/2,t.y+this.map.tileHeight/2)),this.node.active=!0},hide:function(){this.node.active=!1},onPanelClick:function(e){i.instance.emit(s.INSTANTIATE_TOWER,{towerKey:e.target.name,towerCoordinates:this.coordinates})}}),cc._RF.pop()},{EventCode:"EventCode",MainEmitter:"MainEmitter"}],PanelUpgrade:[function(e,t,n){"use strict";cc._RF.push(t,"bf72ccFHBtMv56dPM5YGEyZ","PanelUpgrade");var i=e("MainEmitter"),s=e("EventCode").GAME_EVENTS;cc.Class({extends:cc.Component,properties:{upgradeBtn:cc.Node,sellBtn:cc.Node},init:function(e){this.map=e,this.coordinates={x:0,y:0},this.towerComponent=null,this.upgradeBtn.on("touchend",this.onUpgradeTower,this),this.sellBtn.on("touchend",this.onSellTower,this)},show:function(e,t){this.towerComponent=t,this.coordinates=e;var n=this.map.towersLayer.getPositionAt(this.coordinates);this.node.setPosition(cc.v2(n.x+this.map.tileWidth/2,n.y+this.map.tileHeight/2)),this.node.active=!0},hide:function(){this.node.active=!1},onUpgradeTower:function(){i.instance.emit(s.REQUEST_UPGRADE_TOWER,this.towerComponent),this.hide()},onSellTower:function(){var e=Math.trunc(this.towerComponent.price/2);i.instance.emit(s.SELL_TOWER,e),i.instance.emit(s.DESTROY_TOWER,this.towerComponent),this.hide()}}),cc._RF.pop()},{EventCode:"EventCode",MainEmitter:"MainEmitter"}],PopupSystem:[function(e,t,n){"use strict";cc._RF.push(t,"b9da43kubFIxY4QpXD/uyDe","PopupSystem");var i=e("EventEmitter"),s=e("Key");cc.Class({extends:cc.Component,properties:{},onLoad:function(){i.instance.registerEvent(s.POPUP_SHOW,this.popupShow.bind(this)),i.instance.registerEvent(s.POPUP_HIDE,this.popupHide.bind(this))},popupShow:function(e){e.active=!0},popupHide:function(e){e.active=!1}}),cc._RF.pop()},{EventEmitter:"EventEmitter",Key:"Key"}],SettingController:[function(e,t,n){"use strict";cc._RF.push(t,"f6dfai4LbhH+IgqhT9mSlbR","SettingController");var i=e("EventEmitter"),s=e("Key"),o={sfxVolume:0,musicVolume:0,mouseSpeed:0};cc.Class({extends:cc.Component,properties:{sfxVolumeSlider:cc.Slider,musicVolumeSlider:cc.Slider},ChangeSfxVolume:function(){i.instance.emit(s.CHANGE_SFX_VOLUME,this.sfxVolumeSlider.progress),o.sfxVolume=this.sfxVolumeSlider.progress},ChangeMusicVolume:function(){i.instance.emit(s.CHANGE_MUSIC_VOLUME,this.musicVolumeSlider.progress),o.musicVolume=this.musicVolumeSlider.progress}}),t.exports=o,cc._RF.pop()},{EventEmitter:"EventEmitter",Key:"Key"}],SingleTon:[function(e,t,n){"use strict";cc._RF.push(t,"b91ddA37klL74rfFkCcWAvf","SingleTon");var i=e("EventEmitter");cc.Class({extends:cc.Component,properties:{},onLoad:function(){i.instance=new i}}),cc._RF.pop()},{EventEmitter:"EventEmitter"}],SoundManager:[function(e,t,n){"use strict";cc._RF.push(t,"73fbfUcnI9IHooXEbci6gSm","SoundManager");var i=e("MainEmitter"),s=e("EventCode").SOUND_EVENTS;cc.Class({extends:cc.Component,properties:{tower1Sound:{default:null,type:cc.AudioClip}},onLoad:function(){i.instance.registerEvent(s.TOWER_SHOOT,this.playTowerShootSound.bind(this))},start:function(){},playTowerShootSound:function(){cc.audioEngine.playEffect(this.tower1Sound,!1)}}),cc._RF.pop()},{EventCode:"EventCode",MainEmitter:"MainEmitter"}],SoundSystem:[function(e,t,n){"use strict";cc._RF.push(t,"ff7f7OpPuJLK6uOq4d16tlU","SoundSystem");var i=e("EventEmitter"),s=e("Key");cc.Class({extends:cc.Component,properties:{mMusicSound:cc.AudioSource,mSfxSound:cc.AudioSource},onLoad:function(){i.instance.registerEvent(s.PLAY_MUSIC,this.playMusic.bind(this)),i.instance.registerEvent(s.PLAY_SFX,this.playSfx.bind(this)),i.instance.registerEvent(s.CHANGE_SFX_VOLUME,this.changeSfxVolume.bind(this)),i.instance.registerEvent(s.CHANGE_MUSIC_VOLUME,this.changeMusicVolume.bind(this))},playMusic:function(e){this.mMusicSound.clip=e,this.mMusicSound.play()},playSfx:function(e){this.mSfxSound.clip=e,this.mSfxSound.play()},changeSfxVolume:function(e){this.mSfxSound.volume=e},changeMusicVolume:function(e){this.mMusicSound.volume=e}}),cc._RF.pop()},{EventEmitter:"EventEmitter",Key:"Key"}],TowersData:[function(e,t,n){"use strict";cc._RF.push(t,"a4615+Hvp1MGIfzJVsS8I1V","TowersData");t.exports={TOWER_1_DATA:[{type:"Tower1",level:1,damage:25,reloadTime:1,price:60,upgradePrice:100,attackRange:0,bulletSpriteFrameIndex:0,bulletSize:{width:20,height:20}},{type:"Tower1",level:2,damage:50,reloadTime:1,price:100,upgradePrice:200,attackRange:0,bulletSpriteFrameIndex:1,bulletSize:{width:30,height:30}},{type:"Tower1",level:3,damage:50,reloadTime:1,price:200,upgradePrice:400,attackRange:0,bulletSpriteFrameIndex:2,bulletSize:{width:30,height:30}},{type:"Tower1",level:4,damage:100,reloadTime:1,price:400,upgradePrice:800,attackRange:0,bulletSpriteFrameIndex:3,bulletSize:{width:30,height:30}},{type:"Tower1",level:5,damage:100,reloadTime:1,price:800,upgradePrice:null,attackRange:0,bulletSpriteFrameIndex:4,bulletSize:{width:30,height:38}}],TOWER_2_DATA:[{type:"Tower2",level:1,damage:20,reloadTime:2,price:60,upgradePrice:100,attackRange:1,bulletSpriteFrameIndex:0,bulletSize:{width:20,height:40}},{type:"Tower2",level:2,damage:40,reloadTime:2,price:100,upgradePrice:200,attackRange:1,bulletSpriteFrameIndex:1,bulletSize:{width:20,height:40}},{type:"Tower2",level:3,damage:40,reloadTime:2,price:200,upgradePrice:400,attackRange:1,bulletSpriteFrameIndex:2,bulletSize:{width:20,height:40}},{type:"Tower2",level:4,damage:80,reloadTime:2,price:400,upgradePrice:800,attackRange:1,bulletSpriteFrameIndex:3,bulletSize:{width:20,height:40}},{type:"Tower2",level:5,damage:80,reloadTime:2,price:800,upgradePrice:null,attackRange:1,bulletSpriteFrameIndex:4,bulletSize:{width:25,height:55}}]},cc._RF.pop()},{}],Towers:[function(e,t,n){"use strict";cc._RF.push(t,"91cafmOETRCQrBiZNYxD7zC","Towers");var i=e("MainEmitter"),s=e("EventCode").GAME_EVENTS;cc.Class({extends:cc.Component,properties:{towerPrefabs:[cc.Prefab]},onLoad:function(){this.curTowerNode=null,i.instance.registerEvent(s.INSTANTIATE_TOWER,this.onInstantiateTower.bind(this)),i.instance.registerEvent(s.CREATE_TOWER,this.onCreateTower.bind(this)),i.instance.registerEvent(s.DESTROY_TOWER,this.onDestroyTower.bind(this))},init:function(e){this.map=e,this.towerComponents=[]},onInstantiateTower:function(e){var t=e.towerKey,n=e.towerCoordinates,o=cc.instantiate(this.towerPrefabs.find(function(e){return e.name===t})),r=o.getComponent("Tower");r.init(n,t);var a=this.map.towersLayer.getPositionAt(n);o.setPosition(cc.v2(a.x+this.map.tileWidth/2,a.y+this.map.tileHeight/2)),this.curTowerNode=o,i.instance.emit(s.REQUEST_BUY_TOWER,r.price)},onCreateTower:function(){var e=this.curTowerNode.getComponent("Tower");this.towerComponents.push(e),this.node.addChild(this.curTowerNode)},onDestroyTower:function(e){this.removeTowerComponent(e)},getByCoordinates:function(e){return this.towerComponents.find(function(t){return t.coordinates.x===e.x&&t.coordinates.y===e.y})},removeTowerComponent:function(e){this.towerComponents=this.towerComponents.filter(function(t){return t.coordinates.x!==e.coordinates.x&&t.coordinates.y!==e.coordinates.y}),e.node.destroy()}}),cc._RF.pop()},{EventCode:"EventCode",MainEmitter:"MainEmitter"}],Tower:[function(e,t,n){"use strict";cc._RF.push(t,"22ce26KkJVM1KaiK8h8hxKE","Tower");var i=e("EventEmitter"),s=e("Key"),o=e("TowersData"),r=o.TOWER_1_DATA,a=o.TOWER_2_DATA;cc.Class({extends:cc.Component,properties:{damage:0,reloadTime:0,attackRange:0,rotationSpeed:2e3,price:0,upgradePrice:0,bulletPrefab:cc.Prefab,bulletSpriteFrames:[cc.SpriteFrame],bulletPosition:cc.Node,shootingSound:{type:cc.AudioClip,default:null}},onLoad:function(){this.timer=0,this.currentEnemy=null},update:function(e){this.currentEnemy&&(this.timer+=e,this.timer>=this.reloadTime&&(this.shoot(),this.timer=0))},init:function(e,t){this.coordinates=e,this.level=1,this.maxLevel=5,this.targets=[],this.type=t,this.towerData="Tower1"===this.type?r:a,this.bulletData={damage:null,spriteFrame:null,size:null},this.configTower()},configTower:function(){var e=this.towerData[this.level-1];this.damage=e.damage,this.reloadTime=e.reloadTime,this.price=e.price,this.attackRange=e.attackRange,this.upgradePrice=e.upgradePrice,this.bulletData.damage=e.damage,this.bulletData.size=e.bulletSize,this.bulletData.spriteFrame=this.bulletSpriteFrames[e.bulletSpriteFrameIndex]},upgradeTower:function(){this.level>=this.maxLevel?console.log("Tower max level"):(this.level++,this.configTower(),console.log("Upgrade tower successfully!",this.level))},onCollisionEnter:function(e,t){"enemy"===e.node.name&&(this.targets.push(e.node),this.currentEnemy=this.getTarget())},onCollisionStay:function(e,t){"enemy"===e.node.name&&this.lookAtEnemy(this.currentEnemy)},onCollisionExit:function(e,t){this.removeTarget(e.node),this.currentEnemy=this.getTarget()},removeTarget:function(e){this.targets=this.targets.filter(function(t){return t!==e})},getTarget:function(){return this.targets[0]},shoot:function(){if(this.currentEnemy){var e=cc.instantiate(this.bulletPrefab),t=this.node.convertToWorldSpaceAR(this.bulletPosition.position),n=this.node.parent.convertToNodeSpaceAR(t);e.position=cc.v2(n.x,n.y),e.angle=this.node.angle,e.getComponent("Bullet").configBullet(this.bulletData),this.node.parent.addChild(e),e.getComponent("Bullet").setVelocity(),i.instance.emit(s.PLAY_SFX,this.shootingSound)}},lookAtEnemy:function(e){var t=cc.v2(e.x,e.y),n=cc.v2(this.node.x,this.node.y),i=t.sub(n),s=Math.atan2(i.y,i.x),o=cc.misc.radiansToDegrees(s)-90;this.node.angle=o}}),cc._RF.pop()},{EventEmitter:"EventEmitter",Key:"Key",TowersData:"TowersData"}],UI:[function(e,t,n){"use strict";cc._RF.push(t,"d8cb9xE91JP/4NufbPnG6BL","UI");var i=e("MainEmitter"),s=e("EventCode").UI_EVENTS;cc.Class({extends:cc.Component,properties:{coinAmountLabel:cc.Label,waveAmountLabel:cc.Label,waveTimeoutLabel:cc.Label},onLoad:function(){this.coins=null,this.coinAmountLabel.string=this.coins,this.timer=10,i.instance.registerEvent(s.CREATE_WAVE,this.onCreateWave.bind(this)),i.instance.registerEvent(s.UPDATE_WAVE_COUNT,this.onUpdateWaveCount.bind(this)),i.instance.registerEvent(s.UPDATE_COINS_AMOUNT,this.onUpdateCoinsAmount.bind(this)),this.showWaveTimeout()},start:function(){},onCreateWave:function(){this.showWaveTimeout()},onUpdateWaveCount:function(e){this.waveAmountLabel.string="Wave "+e+"/10"},showWaveTimeout:function(){this.waveTimeoutLabel.string="Next wave in "+this.timer+"s",this.waveTimeoutLabel.node.active=!0,this.schedule(this.countDown,1)},countDown:function(){if(1===this.timer)return this.waveTimeoutLabel.node.active=!1,this.timer=10,void this.unschedule(this.countDown);this.timer--,this.waveTimeoutLabel.string="Next wave in "+this.timer+"s"},onUpdateCoinsAmount:function(e){this.coins=e,this.coinAmountLabel.string=this.coins}}),cc._RF.pop()},{EventCode:"EventCode",MainEmitter:"MainEmitter"}],WaveData:[function(e,t,n){"use strict";cc._RF.push(t,"a7829QRGOhD6oJxFHeM/lsF","WaveData"),cc.Class({extends:cc.Component,properties:{enemies:{default:[],type:[cc.Prefab]},enemiesCount:0,timeout:{default:10,serializable:!0},repeatInterval:1}}),cc._RF.pop()},{}]},{},["SettingController","GameManager","MenuManager","PopupSystem","SoundSystem","EventEmitter","Key","SingleTon","Base","Bullet","Enemy","EnemyWaves","Level","LevelMap","PanelCreate","PanelUpgrade","SoundManager","Tower","Towers","TowersData","UI","WaveData","EventCode","MainEmitter"]);